import{l as P,o as j,j as s,h as R,R as b,T as f,r as m,F as v}from"./index-EVK1cD6X.js";import{S as w,D as T}from"./SearchInput-CevefZ5j.js";import{$ as x,A as C}from"./api-3ipPDxHi.js";import{F as I}from"./Table-BN6g30kQ.js";import{u as L}from"./useDebounce-DzNzz5ny.js";import"./Pagination-DK1ses0D.js";import"./Dropdown-D4uIKH7q.js";const p=P(r=>({posts:[],total:0,isLoading:!1,error:null,fetchPosts:async({page:l,limit:o,searchValue:n})=>{r({isLoading:!0,error:null});try{const a=new URLSearchParams({_page:String(l),_limit:String(o)});n&&a.append("q",n);const[i,c]=await Promise.all([x.get(`/posts?${a.toString()}`),x.get("/users")]),t=c.data,g=i.data.map(d=>{var u;return{...d,authorName:(u=t.find(h=>h.id===d.userId))==null?void 0:u.username}});r({posts:g,total:100,isLoading:!1})}catch{r({error:"Ошибка загрузки постов",isLoading:!1})}}})),E=[{title:"ID",dataIndex:"id",key:"id"},{title:"Заголовок",dataIndex:"title",key:"title",ellipsis:!0},{title:"Автор",dataIndex:"authorName",key:"authorName"}],{Text:S}=f,k=({isLoading:r,posts:l,currentPage:o,total:n,pageSize:a,onChange:i})=>{const c=j();return s.jsx(I,{dataSource:l,columns:E,loading:r,rowKey:"id",scroll:{x:!0},expandable:{expandedRowRender:t=>s.jsxs("div",{children:[s.jsx(S,{strong:!0,children:"Содержание: "}),s.jsx(S,{children:t.body})]}),rowExpandable:t=>t.body!=="Не расширяемый"},pagination:{current:o,pageSize:a,total:n,onChange:i,showSizeChanger:!1},onRow:t=>({onClick:()=>c(`${R(b.POST,{postId:t.id.toString()})}`),style:{cursor:"pointer"}})})},{Title:D}=f,O=()=>{const r=p(e=>e.posts),l=p(e=>e.isLoading),o=p(e=>e.error),n=p(e=>e.total),a=p(e=>e.fetchPosts),[i,c]=m.useState(""),[t,g]=m.useState(1),d=L(i,1e3),u=5,h=e=>{g(e)},y=e=>{c(e.target.value),g(1)};return m.useEffect(()=>{a({page:t,limit:u,searchValue:d})},[t,a,d]),s.jsxs(v,{vertical:!0,gap:16,children:[s.jsx(D,{level:2,style:{marginBottom:0},children:"Посты"}),s.jsx(w,{value:i,onChange:y,placeholder:"Поиск по тексту"}),s.jsx(T,{style:{margin:0}}),o&&s.jsx(C,{type:"error",message:o}),s.jsx(k,{currentPage:t,isLoading:l,posts:r,total:n,pageSize:u,onChange:h})]})};export{O as Component};
